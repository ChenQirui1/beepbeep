# Robot Game - Railway Deployment Guide

A hybrid p5.js frontend with Express backend for AI-powered robot interactions.

## ğŸ—ï¸ Project Structure

```
/my-robot-game
â”œâ”€â”€ dist/               # Generated by 'pnpm build'
â”œâ”€â”€ public/             # Static assets (put ggwave.wasm here)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js         # p5.js Sketch (Instance Mode)
â”‚   â””â”€â”€ style.css       # Styles
â”œâ”€â”€ server.js           # Express + OpenAI backend
â”œâ”€â”€ index.html          # Vite entry point
â”œâ”€â”€ package.json        # Hybrid build/start scripts
â””â”€â”€ .env                # OpenAI API Key (local only)
```

## ğŸš€ Local Development

1. **Install dependencies:**

   ```bash
   pnpm install
   ```

2. **Set up environment:**
   - Copy `.env` and add your OpenAI API key:
     ```
     OPENAI_API_KEY=sk-...
     ```

3. **Run development server:**

   ```bash
   pnpm dev
   ```

   This runs Vite dev server (frontend only).

4. **Test full stack locally:**

   ```bash
   # Build frontend
   pnpm build

   # Start backend (serves built frontend)
   pnpm start
   ```

## ğŸš‚ Railway Deployment

### Step 1: Prepare Repository

Push this project to GitHub (make sure `.env` is in `.gitignore`).

### Step 2: Create Railway Project

1. Go to [railway.app](https://railway.app)
2. Click "New Project" â†’ "Deploy from GitHub repo"
3. Select your repository

### Step 3: Configure Build Settings

In Railway dashboard:

**Build Command:**

```
pnpm run build
```

**Start Command:**

```
pnpm start
```

### Step 4: Add Environment Variables

In Railway â†’ Variables tab, add:

```
OPENAI_API_KEY=sk-your-key-here
```

Railway automatically sets `PORT`, so don't override it.

### Step 5: Deploy

Railway will automatically:

1. Run `pnpm install`
2. Build frontend with `pnpm build` â†’ creates `dist/`
3. Start server with `pnpm start` â†’ runs `server.js`
4. `server.js` serves the `dist/` folder

## ğŸ“¡ API Endpoints

### POST `/api/chat`

Send messages to OpenAI.

**Request:**

```json
{
  "message": "Hello robot!",
  "conversationHistory": []
}
```

**Response:**

```json
{
  "response": "Hello! How can I help you?"
}
```

### GET `/api/health`

Health check endpoint.

## ğŸ¨ p5.js Instance Mode

The sketch uses **Instance Mode** (required for Vite):

```javascript
import p5 from "p5";

const sketch = (s) => {
  s.setup = () => {
    s.createCanvas(800, 400);
  };

  s.draw = () => {
    s.background(30);
  };
};

new p5(sketch);
```

## ğŸ¤ p5.Speech Library

Since `p5.Speech` isn't available as an npm package, it's loaded via CDN in `index.html`:

```html
<script src="https://cdn.jsdelivr.net/gh/IDMNYU/p5.js-speech@latest/lib/p5.speech.js"></script>
```

Access it in your sketch after user interaction (audio context requirement).

## ğŸ”Š ggwave Integration

1. Download `ggwave.wasm` from [ggwave releases](https://github.com/ggerganov/ggwave)
2. Place it in the `public/` directory
3. Vite will serve it at `/ggwave.wasm`

## ğŸ› Troubleshooting

### Audio not working

- Ensure user interaction (click/tap) before starting audio
- Check browser console for AudioContext errors

### OpenAI API errors

- Verify `OPENAI_API_KEY` is set in Railway
- Check Railway logs for detailed error messages

### Build fails on Railway

- Ensure `pnpm-lock.yaml` is committed
- Check Railway build logs for dependency issues

## ğŸ“¦ Scripts

- `pnpm dev` - Start Vite dev server (frontend only)
- `pnpm build` - Build frontend to `dist/`
- `pnpm preview` - Preview built frontend locally
- `pnpm start` - Start production server (serves built frontend + API)

## ğŸ” Security Notes

- Never commit `.env` file
- Use Railway's environment variables for production
- OpenAI API key should only be on backend, never exposed to client

## ğŸ“ Next Steps

- [ ] Add speech recognition in `src/main.js`
- [ ] Integrate ggwave for audio data transmission
- [ ] Add robot animation states
- [ ] Implement conversation history UI
- [ ] Add error handling for API calls
